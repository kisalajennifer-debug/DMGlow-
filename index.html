<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DMGlow Social Reply Engine</title>
<link rel="stylesheet" href="style.css">

<style>
.analysis-box {
  margin-top: 15px;
  padding: 12px;
  border: 1px solid #C9A227;
  border-radius: 12px;
  font-size: 14px;
  background: rgba(201,162,39,0.08);
}
</style>

</head>

<body>

<div class="app">
<h1>DMGlow Social Reply Engine</h1>

<textarea id="userInput" placeholder="Paste the message you received or record voice..."></textarea>

<div class="controls">
<select id="tone">
<option value="magnetic">Magnetic Authority</option>
<option value="strategic">Strategic High Value</option>
<option value="balanced">Power Balanced</option>
</select>

<button id="recordBtn" class="generate-btn">üé§ Record Voice</button>
</div>

<div id="analysisBox" class="analysis-box"></div>

<audio id="audioPlayback" controls style="width:100%; margin-top:10px;"></audio>

<button class="generate-btn" onclick="generateReply()">Generate Replies</button>

<div class="results" id="outputArea"></div>

</div>

<script>

// ================= GLOBAL =================
let selectedText = "";
let mediaRecorder = null;
let audioChunks = [];
let streamRef = null;
let recognition = null;

// ================= EMOTION DETECTION =================
function detectEmotion(text) {
  text = text.toLowerCase();

  if (/(love|miss|happy|excited|proud|beautiful|amazing)/.test(text)) {
    return { label: "Positive Energy ‚ù§Ô∏è", type: "positive" };
  }

  if (/(sorry|confused|tired|hurt|sad|alone|disappointed|unsure)/.test(text)) {
    return { label: "Vulnerable Energy üß°", type: "vulnerable" };
  }

  if (/(hate|angry|annoyed|frustrated|upset|irritated)/.test(text)) {
    return { label: "Heated Energy üî•", type: "heated" };
  }

  return { label: "Neutral / Testing Energy ü§ç", type: "neutral" };
}

// ================= GENERATOR =================
function generateReply() {

const inputText = document.getElementById("userInput").value.trim();
const tone = document.getElementById("tone").value;
const outputArea = document.getElementById("outputArea");
const analysisBox = document.getElementById("analysisBox");

if (!inputText) {
alert("Please enter or record a message first.");
return;
}

const emotion = detectEmotion(inputText);

analysisBox.innerHTML = `
<strong>Detected Energy:</strong> ${emotion.label}<br>
<strong>Response Mode:</strong> ${tone}
`;

let responses = [];

if (emotion.type === "positive") {
responses = [
"Confidence suits someone who speaks like that.",
"Energy like this deserves intention, not impulse.",
"You don‚Äôt say things without meaning them."
];
}

if (emotion.type === "vulnerable") {
responses = [
"Some exhaustion comes from carrying more than you should.",
"Rest isn‚Äôt weakness. It‚Äôs recalibration.",
"You don‚Äôt have to solve everything at once."
];
}

if (emotion.type === "heated") {
responses = [
"Strong reactions usually hide something deeper.",
"I prefer clarity over intensity.",
"Let‚Äôs slow this down before it escalates."
];
}

if (emotion.type === "neutral") {
responses = [
"I‚Äôm listening. Continue.",
"Interesting choice of words.",
"There‚Äôs more behind that, isn‚Äôt there?"
];
}

if (tone === "strategic") {
responses = responses.map(r => r + " Precision changes outcomes.");
}

if (tone === "balanced") {
responses = responses.map(r => r + " Strength doesn‚Äôt require noise.");
}

outputArea.innerHTML = "";
selectedText = "";

responses.sort(() => 0.5 - Math.random()).slice(0,3).forEach(reply => {

const box = document.createElement("div");
box.className = "reply-box";
box.textContent = reply;

box.onclick = function() {
selectedText = reply;
document.querySelectorAll(".reply-box")
.forEach(b => b.style.border = "1px solid #C9A227");
box.style.border = "2px solid white";
};

outputArea.appendChild(box);

});
}

// ================= VOICE RECORDING =================
const recordBtn = document.getElementById("recordBtn");
const audioPlayback = document.getElementById("audioPlayback");
const userInput = document.getElementById("userInput");

if ('webkitSpeechRecognition' in window) {
recognition = new webkitSpeechRecognition();
recognition.continuous = false;
recognition.interimResults = false;
recognition.lang = "en-US";

recognition.onresult = function(event) {
userInput.value = event.results[0][0].transcript;
};

recognition.onend = function() {
recordBtn.textContent = "üé§ Record Voice";
};
}

recordBtn.addEventListener("click", async () => {

if (!mediaRecorder || mediaRecorder.state === "inactive") {

try {
streamRef = await navigator.mediaDevices.getUserMedia({ audio: true });
mediaRecorder = new MediaRecorder(streamRef);
audioChunks = [];

mediaRecorder.start();
if (recognition) recognition.start();

recordBtn.textContent = "‚èπ Stop Recording";

mediaRecorder.ondataavailable = e => {
audioChunks.push(e.data);
};

mediaRecorder.onstop = () => {
const blob = new Blob(audioChunks, { type: "audio/webm" });
const audioURL = URL.createObjectURL(blob);
audioPlayback.src = audioURL;
if (recognition) recognition.stop();
recordBtn.textContent = "üé§ Record Voice";
streamRef.getTracks().forEach(track => track.stop());
};

} catch (err) {
alert("Microphone permission denied.");
}

} else {
mediaRecorder.stop();
}

});

</script>

</body>
</html>
