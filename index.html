<script>
let selectedText = "";

/* ===== VOICE SYSTEM ===== */

const voiceBtn = document.createElement("button");
voiceBtn.innerText = "ðŸŽ¤ Speak Instead";
voiceBtn.className = "generate-btn";
voiceBtn.style.marginBottom = "10px";

document.querySelector(".app").insertBefore(
  voiceBtn,
  document.querySelector(".controls")
);

if ('webkitSpeechRecognition' in window) {

  const recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "en-US";

  voiceBtn.onclick = function () {
    recognition.start();
    voiceBtn.innerText = "Listening...";
  };

  recognition.onresult = function (event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById("userInput").value = transcript;
    recognition.stop();
  };

  recognition.onend = function () {
    voiceBtn.innerText = "ðŸŽ¤ Speak Instead";
  };

  recognition.onerror = function () {
    voiceBtn.innerText = "ðŸŽ¤ Speak Instead";
    alert("Voice recognition failed. Try Chrome.");
  };

} else {
  voiceBtn.style.display = "none";
}

/* ===== REPLY SYSTEM ===== */

function generateReply() {
  const mood = document.getElementById("tone").value;
  const outputArea = document.getElementById("outputArea");
  const inputText = document.getElementById("userInput").value;

  if (!inputText) {
    alert("Please enter or speak a message first.");
    return;
  }

  const replies = {
    chill: [
      `Interesting... "${inputText}" caught my attention.`,
      `Hmm. That energy is different.`,
      `Okay now weâ€™re talking.`,
      `I wasnâ€™t expecting that.`,
      `You said "${inputText}" like you meant it.`
    ],
    playful: [
      `"${inputText}"? Oh weâ€™re bold today.`,
      `You woke up and chose chaos huh?`,
      `Now thatâ€™s interesting energy.`,
      `Should I be impressed or worried?`,
      `I see what youâ€™re doing there ðŸ˜Œ`
    ],
    confident: [
      `"${inputText}" â€” strong move.`,
      `I respect the directness.`,
      `Not everyone would say that.`,
      `Confidence looks good on you.`,
      `That was intentional. I can tell.`
    ],
    witty: [
      `"${inputText}" has main character energy.`,
      `Plot twistâ€¦ I liked that.`,
      `You might actually win this one.`,
      `That delivery? Smooth.`,
      `I didnâ€™t see that coming.`
    ],
    mysterious: [
      `"${inputText}"â€¦ intriguing.`,
      `Continue.`,
      `Thereâ€™s more behind that.`,
      `Youâ€™re hinting at something.`,
      `Iâ€™m listening. Carefully.`
    ]
  };

  outputArea.innerHTML = "";
  selectedText = "";

  const selectedReplies = replies[mood];

  // randomize replies for uniqueness
  const shuffled = selectedReplies.sort(() => 0.5 - Math.random());

  shuffled.forEach(reply => {
    const box = document.createElement("div");
    box.className = "reply-box";

    const p = document.createElement("p");
    p.textContent = reply;

    box.appendChild(p);

    box.onclick = function() {
      selectedText = reply;
      document.querySelectorAll(".reply-box")
        .forEach(b => b.style.border = "1px solid #C9A227");
      box.style.border = "2px solid white";
    };

    outputArea.appendChild(box);
  });
}

/* ===== SHARE ===== */

function nativeShare() {
  if (!selectedText) return alert("Select a reply first.");

  if (navigator.share) {
    navigator.share({
      title: "DMGlow Reply",
      text: selectedText
    });
  } else {
    alert("Sharing not supported on this device.");
  }
}

function shareWhatsApp() {
  if (!selectedText) return alert("Select a reply first.");
  window.open("https://wa.me/?text=" + encodeURIComponent(selectedText));
}

function shareFacebook() {
  if (!selectedText) return alert("Select a reply first.");
  window.open("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(selectedText));
}

function shareLinkedIn() {
  if (!selectedText) return alert("Select a reply first.");
  window.open("https://www.linkedin.com/sharing/share-offsite/?url=" + encodeURIComponent(selectedText));
}
</script>
