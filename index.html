<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DMGlow Emotional Intelligence Engine</title>
<link rel="stylesheet" href="style.css">

<style>
.analysis-box{
  margin-top:15px;
  padding:12px;
  border:1px solid #C9A227;
  border-radius:12px;
  font-size:14px;
  background:rgba(201,162,39,0.08);
}
.mode-label{
  font-size:13px;
  opacity:0.8;
  margin-top:5px;
}
</style>

</head>
<div id="premiumModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); justify-content:center; align-items:center;">
  <div style="background:#243447; padding:30px; border-radius:16px; max-width:400px; text-align:center; border:1px solid #C9A227;">
    <h2 style="color:#C9A227;">Upgrade to DMGlow Premium</h2>
    <p style="margin-top:10px;">
      Unlock full emotional intelligence modes, unlimited intelligent replies,
      and priority AI authority shaping.
    </p>
    <button onclick="unlockPremium()" class="generate-btn" style="margin-top:15px;">
      Upgrade Now
    </button>
    <button onclick="closeModal()" style="margin-top:10px; background:none; color:white; border:none;">
      Maybe Later
    </button>
  </div>
</div>
<body>

<div class="app">
<h1>DMGlow Emotional Intelligence Engine</h1>

<textarea id="userInput" placeholder="Paste the message you received or record voice..."></textarea>

<div class="controls">
<select id="mode">
<option value="magnetic">Magnetic Authority</option>
<option value="strategic">Strategic High Value</option>
<option value="balanced">Power Balanced</option>
<option value="dating">Dating Psychology</option>
<option value="business">Corporate / Business</option>
</select>

<button id="recordBtn" class="generate-btn">ðŸŽ¤ Record Voice</button>
</div>

<div id="analysisBox" class="analysis-box"></div>

<audio id="audioPlayback" controls style="width:100%; margin-top:10px;"></audio>

<button class="generate-btn" onclick="generateReply()">Generate Intelligent Replies</button>

<div class="results" id="outputArea"></div>

</div>
let isPremium = false;
<script>

// ================= GLOBAL =================
let selectedText="";
let usedReplies=new Set();
let mediaRecorder=null;
let audioChunks=[];
let streamRef=null;
let recognition=null;

// ================= MULTI-EMOTION DETECTION =================
function detectEmotion(text){
text=text.toLowerCase();

let score={
positive:0,
vulnerable:0,
heated:0,
neutral:0
};

if(/love|happy|excited|amazing|beautiful|miss/.test(text)) score.positive++;
if(/sorry|confused|tired|hurt|sad|alone|disappointed/.test(text)) score.vulnerable++;
if(/hate|angry|annoyed|frustrated|upset/.test(text)) score.heated++;

if(score.positive===0 && score.vulnerable===0 && score.heated===0){
score.neutral++;
}

let primary=Object.keys(score).reduce((a,b)=>score[a]>score[b]?a:b);

return primary;
}

// ================= REPLY POOLS =================
const replyBank={

positive:[
"Confidence like that should be intentional.",
"Energy attracts alignment, not randomness.",
"You speak with certainty â€” I respect that."
],

vulnerable:[
"Not everything needs immediate resolution.",
"Strength also exists in reflection.",
"Some clarity only comes after pause."
],

heated:[
"I prefer precision over reaction.",
"Intensity rarely builds outcomes.",
"Letâ€™s recalibrate before we escalate."
],

neutral:[
"Thereâ€™s depth behind that.",
"Iâ€™m observing before responding.",
"Continue â€” Iâ€™m assessing."
]
};

// ================= MODE MODIFIERS =================
function applyMode(reply,mode){

if(mode==="strategic")
return reply+" Timing defines leverage.";

if(mode==="balanced")
return reply+" Power doesnâ€™t compete.";

if(mode==="dating")
return reply+" Attraction grows in emotional control.";

if(mode==="business")
return reply+" Execution matters more than emotion.";

return reply;
}

// ================= GENERATOR =================
function generateReply(){

const inputText=document.getElementById("userInput").value.trim();
const mode=document.getElementById("mode").value;
const outputArea=document.getElementById("outputArea");
const analysisBox=document.getElementById("analysisBox");

if(!inputText){
alert("Enter or record a message first.");
return;
}

const emotion=detectEmotion(inputText);

analysisBox.innerHTML=`
<strong>Detected Emotional Core:</strong> ${emotion.toUpperCase()}<br>
<strong>Mode:</strong> ${mode}
`;

outputArea.innerHTML="";
selectedText="";

let pool=[...replyBank[emotion]];

// remove already used replies for uniqueness
pool=pool.filter(r=>!usedReplies.has(r));

if(pool.length===0){
usedReplies.clear();
pool=[...replyBank[emotion]];
}

pool.sort(()=>0.5-Math.random());

const replyLimit = isPremium ? 3 : 1;

if(!isPremium){
  document.getElementById("premiumModal").style.display="flex";
}

pool.slice(0,replyLimit).forEach(reply=>{
const modified=applyMode(reply,mode);
usedReplies.add(reply);

const box=document.createElement("div");
box.className="reply-box";
box.textContent=modified;

box.onclick=function(){
selectedText=modified;
document.querySelectorAll(".reply-box")
.forEach(b=>b.style.border="1px solid #C9A227");
box.style.border="2px solid white";
};

outputArea.appendChild(box);

});
}

// ================= VOICE RECORDING + STT =================
const recordBtn=document.getElementById("recordBtn");
const audioPlayback=document.getElementById("audioPlayback");
const userInput=document.getElementById("userInput");

if('webkitSpeechRecognition' in window){
recognition=new webkitSpeechRecognition();
recognition.continuous=false;
recognition.interimResults=false;
recognition.lang="en-US";

recognition.onresult=function(event){
userInput.value=event.results[0][0].transcript;
};

recognition.onend=function(){
recordBtn.textContent="ðŸŽ¤ Record Voice";
};
}

recordBtn.addEventListener("click",async()=>{

if(!mediaRecorder||mediaRecorder.state==="inactive"){

try{
streamRef=await navigator.mediaDevices.getUserMedia({audio:true});
mediaRecorder=new MediaRecorder(streamRef);
audioChunks=[];

mediaRecorder.start();
if(recognition) recognition.start();

recordBtn.textContent="â¹ Stop Recording";

mediaRecorder.ondataavailable=e=>{
audioChunks.push(e.data);
};

mediaRecorder.onstop=()=>{
const blob=new Blob(audioChunks,{type:"audio/webm"});
audioPlayback.src=URL.createObjectURL(blob);
if(recognition) recognition.stop();
recordBtn.textContent="ðŸŽ¤ Record Voice";
streamRef.getTracks().forEach(track=>track.stop());
};

}catch(err){
alert("Microphone permission denied.");
}

}else{
mediaRecorder.stop();
}

});

</script>

</body>
</html>
