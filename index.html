<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DMGlow Social Reply Engine</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="app">
<h1>DMGlow Social Reply Engine</h1>

<textarea id="userInput" placeholder="Paste the message you received or record voice..."></textarea>

<div class="controls">
<select id="tone">
<option value="chill">Chill</option>
<option value="playful">Playful</option>
<option value="confident">Confident</option>
<option value="witty">Witty</option>
<option value="mysterious">Mysterious</option>
</select>

<button id="recordBtn" class="generate-btn">ðŸŽ¤ Record Voice</button>
</div>

<audio id="audioPlayback" controls style="width:100%; margin-top:10px;"></audio>

<div style="display:flex; gap:10px; margin-top:10px;">
<button id="downloadBtn" class="generate-btn">â¬‡ Download</button>

<select id="speedControl" class="generate-btn">
<option value="1">1x Speed</option>
<option value="1.25">1.25x</option>
<option value="1.5">1.5x</option>
<option value="2">2x</option>
</select>
</div>

<button class="generate-btn" onclick="generateReply()">Generate Replies</button>

<div class="results" id="outputArea"></div>

<div style="margin-top:20px; display:flex; flex-direction:column; gap:10px;">
<button class="generate-btn" onclick="nativeShare()">Share (All Apps)</button>
<button class="generate-btn" onclick="shareWhatsApp()">Send to WhatsApp</button>
<button class="generate-btn" onclick="shareFacebook()">Share to Facebook</button>
<button class="generate-btn" onclick="shareLinkedIn()">Share to LinkedIn</button>
</div>

</div>

<script>

// ================= GLOBAL =================
let selectedText = "";
let mediaRecorder = null;
let audioChunks = [];
let streamRef = null;
let recognition = null;
let isListening = false;

// ================= REPLY ENGINE =================
function generateReply() {

const mood = document.getElementById("tone").value;
const outputArea = document.getElementById("outputArea");
const inputText = document.getElementById("userInput").value.trim();

if (!inputText) {
alert("Please enter or record a message first.");
return;
}

const variations = {
chill: [
`Hmm... "${inputText}"? I like that energy.`,
`Thatâ€™s interesting ðŸ‘€ Tell me more.`,
`"${inputText}" sounds like thereâ€™s a story there.`,
`Okay okayâ€¦ wasnâ€™t expecting that.`,
`Now youâ€™ve got my attention.`
],
playful: [
`"${inputText}"? Bold today ðŸ˜Œ`,
`Should I be impressed?`,
`Look at you starting something.`,
`Confidence looks good on you.`,
`Dangerous energy detected ðŸ˜‚`
],
confident: [
`"${inputText}" â€” I respect that.`,
`Interesting energy.`,
`Confidence suits you.`,
`You knew what you were doing.`,
`I see intention there.`
],
witty: [
`"${inputText}" unlocked a plot twist.`,
`Main character moment.`,
`That line deserves a sequel.`,
`Unexpected but clever.`,
`You might be onto something.`
],
mysterious: [
`"${inputText}"â€¦ intriguing.`,
`Continue.`,
`Iâ€™m listening.`,
`Thereâ€™s depth there.`,
`Noted.`
]
};

outputArea.innerHTML = "";
selectedText = "";

const shuffled = variations[mood].sort(() => 0.5 - Math.random());

shuffled.slice(0,3).forEach(reply => {
const box = document.createElement("div");
box.className = "reply-box";
box.textContent = reply;

box.onclick = function() {
selectedText = reply;
document.querySelectorAll(".reply-box")
.forEach(b => b.style.border = "1px solid #C9A227");
box.style.border = "2px solid white";
};

outputArea.appendChild(box);
});
}

// ================= SHARE =================
function nativeShare() {
if (!selectedText) return alert("Select a reply first.");
if (navigator.share) {
navigator.share({ title: "DMGlow Reply", text: selectedText });
} else {
alert("Sharing not supported.");
}
}

function shareWhatsApp() {
if (!selectedText) return alert("Select a reply first.");
window.open("https://wa.me/?text=" + encodeURIComponent(selectedText), "_blank");
}

function shareFacebook() {
if (!selectedText) return alert("Select a reply first.");
window.open("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(selectedText), "_blank");
}

function shareLinkedIn() {
if (!selectedText) return alert("Select a reply first.");
window.open("https://www.linkedin.com/sharing/share-offsite/?url=" + encodeURIComponent(selectedText), "_blank");
}

// ================= VOICE =================
const recordBtn = document.getElementById("recordBtn");
const audioPlayback = document.getElementById("audioPlayback");
const downloadBtn = document.getElementById("downloadBtn");
const speedControl = document.getElementById("speedControl");
const userInput = document.getElementById("userInput");

// Speed control
speedControl.addEventListener("change", () => {
audioPlayback.playbackRate = parseFloat(speedControl.value);
});

// Download audio
downloadBtn.addEventListener("click", () => {
if (!audioPlayback.src) return alert("No recording available.");
const a = document.createElement("a");
a.href = audioPlayback.src;
a.download = "DMGlow-recording.webm";
a.click();
});

// Speech Recognition (Chrome)
if ('webkitSpeechRecognition' in window) {
recognition = new webkitSpeechRecognition();
recognition.lang = "en-US";

recognition.onresult = function(event) {
userInput.value = event.results[0][0].transcript;
generateReply(); // Auto generate after speech
};
}

recordBtn.addEventListener("click", async () => {

if (!mediaRecorder || mediaRecorder.state === "inactive") {

try {
streamRef = await navigator.mediaDevices.getUserMedia({ audio: true });
mediaRecorder = new MediaRecorder(streamRef);
audioChunks = [];

mediaRecorder.start();
if (recognition) recognition.start();

recordBtn.textContent = "â¹ Stop Recording";
isListening = true;

mediaRecorder.ondataavailable = e => {
audioChunks.push(e.data);
};

mediaRecorder.onstop = () => {

const blob = new Blob(audioChunks, { type: "audio/webm" });
audioPlayback.src = URL.createObjectURL(blob);

recordBtn.textContent = "ðŸŽ¤ Record Voice";
isListening = false;

streamRef.getTracks().forEach(track => track.stop());
};

} catch (err) {
alert("Microphone permission denied.");
}

} else {
mediaRecorder.stop();
if (recognition) recognition.stop();
}

});

</script>

</body>
</html>
